
- name: Install SDKMAN
  shell: |
    curl -s "https://get.sdkman.io" | bash
  args:
    executable: /bin/bash

- name: Configure SDKMAN configuration
  block:
    - name: Remove the previous SDKMAN configuration
      blockinfile:
        path: "{{ user_home_dir }}/.bashrc"
        append_newline: yes
        marker: "# ANSIBLE: {mark}"
        state: absent
    - name: Configure SDKMAN in bashrc
      blockinfile:
        path: "{{ user_home_dir }}/.bashrc"
        prepend_newline: yes
        append_newline: yes
        marker: "# ANSIBLE: {mark}"
        block: |
          export SDKMAN_OFFLINE_MODE=false
          [[ -s "$SDKMAN_DIR/bin/sdkman-init.sh" ]] && source "$SDKMAN_DIR/bin/sdkman-init.sh"
          export SDKMAN_DIR=$HOME/.sdkman
  become: false

- name: Refresh shell environment
  shell: |
    source {{ user_home_dir }}/.bashrc
  args:
    executable: /bin/bash

- name: Install Java Temurin {{ java_version }} using SDKMAN
  shell: |
    source {{ user_home_dir }}/.sdkman/bin/sdkman-init.sh && sdk install java {{ java_version }}
  args:
    executable: /bin/bash
  environment:
    SDKMAN_DIR: "{{ user_home_dir }}/.sdkman"

- name: Install Gradle {{ gradle_version}} using SDKMAN
  shell: |
    source {{ user_home_dir }}/.sdkman/bin/sdkman-init.sh && sdk install gradle {{ gradle_version }}
  args:
    executable: /bin/bash
  environment:
    SDKMAN_DIR: "{{ user_home_dir }}/.sdkman"